<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plateforme - Selection - Claque Doigts</title>
    <link rel="stylesheet" href="https://use.typekit.net/wdg2wjk.css">
    <link rel="stylesheet" href="../css/ui-kit.css">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header class="header header-purple">
        <div class="header-content">
            <a class="header-logo">
                <img src="https://raw.githubusercontent.com/heylynncontact-cpu/claque-doigts/main/assets/icons/Lettermark.svg" alt="Claque Doigts">
            </a>
        </div>
        <div class="progress-bar-container">
            <div class="progress-step completed clickable">
                <div class="progress-step-label">
                    <div class="progress-step-icon"></div>
                    <span>Cibles</span>
                </div>
                <div class="progress-step-bar">
                    <div class="progress-step-bar-fill" style="width: 100%;"></div>
                </div>
            </div>
            <div class="progress-step completed">
                <div class="progress-step-label">
                    <div class="progress-step-icon"></div>
                    <span>Plateforme</span>
                </div>
                <div class="progress-step-bar">
                    <div class="progress-step-bar-fill" style="width: 100%;"></div>
                </div>
            </div>
            <div class="progress-step">
                <div class="progress-step-label">
                    <div class="progress-step-icon"></div>
                    <span>Pilliers</span>
                </div>
                <div class="progress-step-bar">
                    <div class="progress-step-bar-fill"></div>
                </div>
            </div>
            <div class="progress-step">
                <div class="progress-step-label">
                    <div class="progress-step-icon"></div>
                    <span>Parcours</span>
                </div>
                <div class="progress-step-bar">
                    <div class="progress-step-bar-fill"></div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="page-container">
        <div class="full-layout">
            <button onclick="window.location.href='./plateforme-mono-multi.html'" style="border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-bottom: 24px; font-size: 16px;"><img src="https://raw.githubusercontent.com/heylynncontact-cpu/claque-doigts/main/assets/icons/keyboard_arrow.svg" alt="" style="width: 24px; height: 24px; transform: rotate(180deg);">Retour</button>
            <div class="section-content">
                <div class="section-question">
                    <h2>S√©lectionnez vos plateformes</h2>
                    <p style="font-size: 14px; color: #666; margin-top: 8px;" id="selection-info">S√©lectionnez 1 √† 3 plateformes</p>
                    
                    <div class="cards-grid" id="platforms-grid" style="display: grid; grid-template-columns: repeat(2, 393px); gap: 24px; justify-content: center;">
                        <!-- TikTok -->
                        <div class="choice-card" data-value="tiktok" style="width: 393px; height: auto; background: white; border: 3px solid #D8D8D8; border-radius: 16px; padding: 16px 18px 23px 18px; display: flex; flex-direction: column; gap: 17px; cursor: pointer;">
                            <!-- Rectangle rose en-t√™te -->
                            <div style="width: 100%; height: 123px; background: rgba(255, 192, 203, 0.6); border-radius: 15px; padding: 16px; display: flex; flex-direction: column; justify-content: center; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <img src="https://raw.githubusercontent.com/heylynncontact-cpu/claque-doigts/main/assets/icons/tiktok.svg" alt="" style="width: 36px; height: 36px;">
                                    <h3 style="font-weight: 600; font-size: 20px; margin: 0;">TikTok</h3>
                                </div>
                            </div>
                            
                            <!-- Frame Objectifs -->
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <p style="font-weight: 600; font-size: 14px; margin: 0; color: #333;">Objectifs</p>
                                <p style="font-weight: 400; font-size: 14px; margin: 0; color: #666;">Id√©al pour toucher un public jeune avec du contenu viral et tendances</p>
                            </div>
                            
                            <!-- Frame Cibles -->
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <p style="font-weight: 600; font-size: 14px; margin: 0; color: #333;">Cibles</p>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">16-25 ans</span>
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">Mode, Beaut√©</span>
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">Gaming, Musique</span>
                                </div>
                            </div>
                            
                            <!-- Container pour recommandation (rempli par JS) -->
                            <div class="recommendation-container" data-platform="tiktok"></div>
                        </div>
                        
                        <!-- Instagram -->
                        <div class="choice-card" data-value="instagram" style="width: 393px; height: auto; background: white; border: 3px solid #D8D8D8; border-radius: 16px; padding: 16px 18px 23px 18px; display: flex; flex-direction: column; gap: 17px; cursor: pointer;">
                            <div style="width: 100%; height: 123px; background: rgba(255, 192, 203, 0.6); border-radius: 15px; padding: 16px; display: flex; flex-direction: column; justify-content: center; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <img src="https://raw.githubusercontent.com/heylynncontact-cpu/claque-doigts/main/assets/icons/instagram.svg" alt="" style="width: 36px; height: 36px;">
                                    <h3 style="font-weight: 600; font-size: 20px; margin: 0;">Instagram</h3>
                                </div>
                            </div>
                            
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <p style="font-weight: 600; font-size: 14px; margin: 0; color: #333;">Objectifs</p>
                                <p style="font-weight: 400; font-size: 14px; margin: 0; color: #666;">Parfait pour le contenu visuel, lifestyle et influence</p>
                            </div>
                            
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <p style="font-weight: 600; font-size: 14px; margin: 0; color: #333;">Cibles</p>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">16-35 ans</span>
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">Mode, Beaut√©, Food</span>
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">Voyage, Sport</span>
                                </div>
                            </div>
                            
                            <div class="recommendation-container" data-platform="instagram"></div>
                        </div>
                        
                        <!-- LinkedIn -->
                        <div class="choice-card" data-value="linkedin" style="width: 393px; height: auto; background: white; border: 3px solid #D8D8D8; border-radius: 16px; padding: 16px 18px 23px 18px; display: flex; flex-direction: column; gap: 17px; cursor: pointer;">
                            <div style="width: 100%; height: 123px; background: rgba(173, 216, 230, 0.6); border-radius: 15px; padding: 16px; display: flex; flex-direction: column; justify-content: center; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <img src="https://raw.githubusercontent.com/heylynncontact-cpu/claque-doigts/main/assets/icons/linkedin.svg" alt="" style="width: 36px; height: 36px;">
                                    <h3 style="font-weight: 600; font-size: 20px; margin: 0;">LinkedIn</h3>
                                </div>
                            </div>
                            
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <p style="font-weight: 600; font-size: 14px; margin: 0; color: #333;">Objectifs</p>
                                <p style="font-weight: 400; font-size: 14px; margin: 0; color: #666;">Incontournable pour le B2B et networking professionnel</p>
                            </div>
                            
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <p style="font-weight: 600; font-size: 14px; margin: 0; color: #333;">Cibles</p>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">25-50 ans</span>
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">Professionnels</span>
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">B2B</span>
                                </div>
                            </div>
                            
                            <div class="recommendation-container" data-platform="linkedin"></div>
                        </div>
                        
                        <!-- Facebook -->
                        <div class="choice-card" data-value="facebook" style="width: 393px; height: auto; background: white; border: 3px solid #D8D8D8; border-radius: 16px; padding: 16px 18px 23px 18px; display: flex; flex-direction: column; gap: 17px; cursor: pointer;">
                            <div style="width: 100%; height: 123px; background: rgba(173, 216, 230, 0.6); border-radius: 15px; padding: 16px; display: flex; flex-direction: column; justify-content: center; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <img src="https://raw.githubusercontent.com/heylynncontact-cpu/claque-doigts/main/assets/icons/facebook.svg" alt="" style="width: 36px; height: 36px;">
                                    <h3 style="font-weight: 600; font-size: 20px; margin: 0;">Facebook</h3>
                                </div>
                            </div>
                            
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <p style="font-weight: 600; font-size: 14px; margin: 0; color: #333;">Objectifs</p>
                                <p style="font-weight: 400; font-size: 14px; margin: 0; color: #666;">Port√©e massive et groupes communautaires cibl√©s</p>
                            </div>
                            
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 6px;">
                                <p style="font-weight: 600; font-size: 14px; margin: 0; color: #333;">Cibles</p>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">35+ ans</span>
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">Tout public</span>
                                    <span style="border: 1px solid #5B9BD5; border-radius: 8px; padding: 4px 11px; font-weight: 500; font-size: 12px; color: #5B9BD5;">Communaut√©s</span>
                                </div>
                            </div>
                            
                            <div class="recommendation-container" data-platform="facebook"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <button class="btn btn-green btn-big btn-validate" id="btn-validate">Valider</button>
    
    <footer class="footer">
        <div class="footer-content">
            <p>2025 Claque Doigts - Tous droits r√©serv√©s</p>
        </div>
    </footer>
    
    <script src="../js/firebase-config.js"></script>
    <script src="../js/platform-recommendation.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        const selectedPlatforms = [];
        let maxSelection = 3;
        const clientId = localStorage.getItem("current_client_id");
        
        // AJOUTER LES RECOMMANDATIONS DANS LES CONTAINERS
        if (clientId && typeof calculateRecommendations === "function") {
            try {
                const strategy = JSON.parse(localStorage.getItem("strategy_" + clientId) || "{}");
                const recommendations = calculateRecommendations(strategy);
                
                // Cr√©er un map des scores
                const scoresMap = {};
                recommendations.forEach(rec => {
                    scoresMap[rec.platform] = rec;
                });
                
                // Remplir les containers
                document.querySelectorAll(".recommendation-container").forEach(container => {
                    const platform = container.getAttribute("data-platform");
                    const rec = scoresMap[platform];
                    
                    if (rec && rec.score >= 40) {
                        const badge = rec.score >= 75 ? "Tr√®s recommand√©" : rec.score >= 60 ? "Recommand√©" : "√Ä consid√©rer";
                        const badgeColor = rec.score >= 75 ? "#CDF667" : rec.score >= 60 ? "#DEC5FD" : "#B3D9FF";
                        
                        container.innerHTML = `
                            <div style="width: 100%; padding: 15px 27px; border: 1px solid #D8D8D8; border-radius: 15px; display: flex; flex-direction: column; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-weight: 400; font-size: 16px; color: #333;">${rec.score}%</span>
                                    <div style="width: 120px; height: 6px; background: #D8D8D8; border-radius: 100px; overflow: hidden;">
                                        <div style="height: 100%; width: ${rec.score}%; background: #5B9BD5; border-radius: 100px;"></div>
                                    </div>
                                    <span style="padding: 4px 11px; border-radius: 8px; background: ${badgeColor}; font-weight: 500; font-size: 12px; white-space: nowrap;">${badge}</span>
                                </div>
                                
                                <details style="margin-top: 4px;">
                                    <summary style="font-weight: 300; font-size: 11px; color: #999; cursor: pointer;">D√©tails du score</summary>
                                    <ul style="margin: 8px 0 0 20px; padding: 0; font-weight: 300; font-size: 11px; color: #666;">
                                        ${rec.details.map(detail => `<li style="margin: 4px 0;">${detail}</li>`).join("")}
                                    </ul>
                                </details>
                            </div>
                        `;
                    }
                });
            } catch(e) {
                console.log("Recommandations non disponibles", e);
            }
        }
        
        // Ajuster maxSelection selon mono/multi
        if (clientId) {
            try {
                const strategy = JSON.parse(localStorage.getItem("strategy_" + clientId) || "{}");
                if (strategy.platformStrategy === "mono") {
                    maxSelection = 1;
                    document.getElementById("selection-info").textContent = "S√©lectionnez 1 plateforme";
                }
            } catch(e) {
                console.log("Erreur strat√©gie", e);
            }
        }
        
        // GESTION DE LA S√âLECTION
        document.querySelectorAll(".choice-card").forEach(function(card) {
            card.addEventListener("click", function() {
                const value = this.getAttribute("data-value");
                if (this.classList.contains("selected")) {
                    this.classList.remove("selected");
                    const index = selectedPlatforms.indexOf(value);
                    if (index > -1) selectedPlatforms.splice(index, 1);
                } else {
                    if (selectedPlatforms.length >= maxSelection) {
                        this.classList.add("shake");
                        setTimeout(() => card.classList.remove("shake"), 300);
                        return;
                    }
                    this.classList.add("selected");
                    selectedPlatforms.push(value);
                }
            });
        });
        
        document.getElementById("btn-validate").addEventListener("click", function() {
            if (selectedPlatforms.length === 0) {
                alert("Veuillez s√©lectionner au moins une plateforme");
                return;
            }
            if (clientId) {
                let strategy = JSON.parse(localStorage.getItem("strategy_" + clientId) || "{}");
                strategy.platforms = selectedPlatforms;
                localStorage.setItem("strategy_" + clientId, JSON.stringify(strategy));
            }
            
            // V√©rifier si l'utilisateur est connect√©
            const isAuth = localStorage.getItem("claque_doigts_auth") === "true";
            if (!isAuth) {
                // Afficher pop-up fin version gratuite
                const popup = document.createElement("div");
                popup.className = "popup-overlay";
                popup.style.display = "flex";
                popup.innerHTML = `
                    <div class="popup">
                        <h2 class="popup-title">üéâ Bravo ! Version gratuite termin√©e</h2>
                        <div class="popup-content">
                            <p>Vous avez compl√©t√© la partie gratuite du formulaire (Cibles et Plateformes).</p>
                            <p>Pour acc√©der aux sections Pilliers et Parcours et g√©n√©rer votre strat√©gie compl√®te, prenez rendez-vous avec nous !</p>
                        </div>
                        <div class="popup-actions">
                            <button class="btn btn-green" style="padding: 4px 24px; border-radius: 5px;" onclick="window.open('https://calendly.com/linevd-pro/une-petite-discussion', '_blank')">Prendre rendez-vous</button>
                            <button class="btn btn-white" style="padding: 4px 24px; border-radius: 5px;" onclick="window.location.href='./recap.html?partial=true'">Voir mon rapport partiel</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(popup);
            } else {
                window.location.href = "./pilliers-intro.html";
            }
        });
    </script>
</body>
</html>
